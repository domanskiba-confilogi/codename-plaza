<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Confilogi IT Support - Report internet issue</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="/tailwind.css">
	</head>
	<body class="bg-neutral-950 text-neutral-200 min-h-screen flex flex-col">
		<div id="error-modal-root"></div>

		<div id="loading-screen"></div>

		<!-- Navbar -->
		<div data-loading="show" class="hidden" id="navbar-root"></div>

		<!-- Main -->
		<main data-loading="show" class="flex-1 hidden">
			<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
				<!-- Page header -->
				<div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-6">
					<div>
						<h1 class="text-xl sm:text-2xl font-semibold">Report issue with sound</h1>
						<p class="text-neutral-400 text-sm">Provide basic information about the person and their issue.</p>
					</div>
					<div class="text-xs text-neutral-500">
						All fields are required unless marked as optional
					</div>
				</div>

				<!-- Form card -->
				<form class="bg-neutral-900/60 ring-1 ring-neutral-800 rounded-2xl p-6 sm:p-8 shadow-lg mb-6">
					<section class="mb-4">
						<h2 class="text-lg font-semibold mb-4">Person who has the problem</h2>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
							<div id="first-name-field"></div>
							<div id="second-name-field"></div>
							<div id="last-name-field"></div>
						</div>
					</section>

					<section class="mb-4">
						<h2 class="text-lg font-semibold mb-4">Contact data</h2>
						<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
							<div id="anydesk-field"></div>
							<div id="computer-id-field"></div>
						</div>
					</section>

					<section class="mb-4">
						<div class="flex flex-col sm:flex-row gap-4 items-center justify-between rounded-xl ring-1 ring-inset ring-neutral-800 bg-neutral-950/60 p-4">
							<div class="flex-grow">
								<p class="text-sm font-medium">Check if your problem is one of these scenarios.</p>
								<p class="text-xs text-neutral-500 mt-1">If not, then please write about it freely in description field.</p>
							</div>
							<div class="flex flex-row flex-wrap gap-2">
								<div id="shortcut-1"></div>
								<div id="shortcut-2"></div>
							</div>
						</div>
					</section>

					<section>
						<div class="grid grid-cols-1 gap-4">
							<div class="min-h-[150px]" id="description-field"></div>
						</div>
					</section>
				</form>

				<!-- Actions -->
				<div class="flex items-center justify-end gap-3">
					<div id="cancel-btn"></div>
					<div id="submit-btn"></div>
				</div>
			</section>
		</main>

		<script src="/main.js"></script>
		<script src="/components/navbar/main.js"></script>
		<script src="/components/text_field/main.js"></script>
		<script src="/components/select_field/main.js"></script>
		<script src="/components/modal/main.js"></script>
		<script src="/components/button/main.js"></script>
		<script src="/components/checkbox_field/main.js"></script>
		<script src="/components/suspense_screen/main.js"></script>
		<script src="/components/textarea_field/main.js"></script>

		<script>
		const authStore = createAuthStore();

		const loadingScreen = mountSuspenseScreen("#loading-screen", {
			message: "Loading needed data...",
		});

		const apiConnector = createApiConnector();

		(async () => {
			try {
				await checkIsLoggedInMiddleware(authStore);

				loadingScreen.destroy();

				Array.from(document.querySelectorAll('[data-loading="show"]')).forEach(element => {
					element.classList.remove("hidden");
				});

				// Navbar
				const navbar = mountNavbar('#navbar-root', {
					brandHref: '/',
					brandName: 'Confilogi',
					brandAccent: 'IT Support',
					...LOGGED_IN_NAVBAR_ARGS
				});

				const fields = {
					firstNameField: mountTextField('#first-name-field', {
						label: 'Name',
						type: 'text',
						placeholder: 'Enter name...',
						value: '',
						clearErrorOnInput: true,
					}),
					secondNameField: mountTextField('#second-name-field', {
						label: 'Second name (optional)',
						type: 'text',
						placeholder: 'Enter second name...',
						value: '',
						clearErrorOnInput: true,
					}),
					lastNameField: mountTextField('#last-name-field', {
						label: 'Surname',
						type: 'text',
						placeholder: 'Enter surname...',
						value: '',
						clearErrorOnInput: true,
					}),
					anydeskField: mountTextField("#anydesk-field", {
						type: 'text',
						label: "Anydesk number",
						placeholder: "e.g., 1 234 567 890",
						value: '',
						clearErrorOnInput: true,
					}),
					computerIdField: mountTextField("#computer-id-field", {
						type: 'text',
						label: `Computer's id`,
						placeholder: "e.g, CONFI-000000000",
						value: '',
						clearErrorOnInput: true,
					}),
					descriptionField: mountTextArea("#description-field", {
						label: "Description of the problem",
						placeholder: "Tell us about your problem...",
						value: '',
						clearErrorOnInput: true,
					}),
				};

				mountButton("#shortcut-1", {
					label: "I hear the customers, they don't hear me.",
					variant: 'secondary',
					size: 'sm',
					onClick: () => {
						fields.descriptionField.setValue("Hello, the person that contact's data is provided inside the ticket can hear the customers, but they don't hear the agent.");
					}
				});

				mountButton("#shortcut-2", {
					label: "I don't hear the customers.",
					variant: 'secondary',
					size: 'sm',
					onClick: () => {
						fields.descriptionField.setValue("Hello, the person that contact's data is provided inside the ticket can't hear the customers.");
					}
				});

				const cancelBtn = mountButton('#cancel-btn', {
					label: 'Cancel',
					variant: 'ghost',
					size: 'sm',
					onClick: () => {
						window.location.href = '/report-problem.html';
					}
				});

				const submitBtn = mountButton('#submit-btn', {
					label: 'Submit',
					variant: 'primary',
					size: 'md',
					type: 'button',
					onClick: () => {
						submitOnboarding();
					}
				});

				// Validation helpers
				function clearAllErrors() {
					Object.values(fields).forEach(f => f.clearError());
				}

				async function submitOnboarding() {
					clearAllErrors();

					// Gather
					const payload = {
						person: {
							name: fields.firstNameField.getValue().trim(),
							secondName: fields.secondNameField.getValue().trim(),
							surname: fields.lastNameField.getValue().trim(),
						},
						computerId: fields.computerIdField.getValue().trim(),
						anydeskNumber: fields.anydeskField.getValue().trim(),
						description: fields.descriptionField.getValue().trim(),
					};

					console.log(payload);
				}
			} catch (error) {
				reportCriticalError(error);
			}
		})();

		</script>
	</body>
</html>
